<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="jakarta.faces.facelets" xmlns:h="jakarta.faces.html"
    xmlns:f="jakarta.faces.core">

    <!-- BLOC FIXE EN BAS À GAUCHE (Conteneur unique avec icônes uniquement) -->
    <div class="fixed bottom-6 left-6 z-50 flex flex-col items-center 
                bg-black/40 backdrop-blur-2xl border border-white/20 
                rounded-2xl shadow-2xl overflow-hidden">

        <!-- Sous-bloc Profil -->
        <button onclick="openProfileModal()" class="p-4 hover:bg-white/10 transition-colors group" title="Mon Profil">
            <svg class="w-6 h-6 text-white group-hover:text-red-400 transition" fill="none" stroke="currentColor"
                viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
        </button>

        <!-- Séparateur discret -->
        <div class="w-8 h-[1px] bg-white/10"></div>

        <!-- Sous-bloc Déconnexion -->
        <div class="p-4 flex items-center justify-center hover:bg-red-600/20 transition-colors group cursor-pointer"
            onclick="openLogoutModal()" title="Déconnexion">
            <svg class="w-6 h-6 text-white group-hover:text-red-500 transition" fill="none" stroke="currentColor"
                viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
            </svg>
        </div>
    </div>

    <!-- MODAL DE CONFIRMATION DE DÉCONNEXION -->
    <div id="logoutModalWrapper" style="display: none;" onclick="closeLogoutModalOnOutside(event)"
        class="fixed inset-0 z-[9999] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4">
        <div
            class="fade-in-scale w-full max-w-sm mx-auto bg-[#121212] border border-white/10 rounded-3xl p-8 shadow-2xl text-white text-center">
            <div
                class="w-16 h-16 rounded-full bg-red-600/20 flex items-center justify-center mx-auto mb-4 border border-red-600/30">
                <svg class="w-8 h-8 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                </svg>
            </div>
            <h3 class="text-xl font-bold mb-2">Déconnexion</h3>
            <p class="text-white/60 text-sm mb-6">Voulez-vous vraiment vous déconnecter de votre session ?</p>
            <div class="flex gap-3">
                <button onclick="closeLogoutModal()"
                    class="flex-1 py-3 rounded-xl font-bold bg-white/5 hover:bg-white/10 transition text-xs uppercase tracking-widest">Annuler</button>
                <h:form styleClass="flex-1 m-0">
                    <h:commandButton action="#{profileBean.logout}" value="Déconnexion"
                        styleClass="w-full py-3 rounded-xl font-bold bg-red-600 hover:bg-red-700 transition shadow-lg text-xs uppercase tracking-widest cursor-pointer" />
                </h:form>
            </div>
        </div>
    </div>

    <!-- MODAL PROFIL -->
    <div id="profileModalWrapper" style="display: none;" onclick="closeProfileModalOnOutside(event)"
        class="fixed inset-0 z-[9999] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4">

        <div class="fade-in-scale w-full max-w-md mx-auto max-h-[90vh] overflow-auto 
                    bg-[#121212] border border-white/10 rounded-3xl p-8 shadow-2xl text-white relative">

            <!-- Icône SVG Profil en haut -->
            <div class="flex justify-center mb-6">
                <div class="w-20 h-20 rounded-full bg-gradient-to-br from-red-500 to-red-700 
                            flex items-center justify-center shadow-xl">
                    <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                </div>
            </div>

            <h:form id="profileForm" styleClass="space-y-5">
                <h:messages globalOnly="true"
                    styleClass="text-sm p-3 rounded-xl bg-red-600/20 border border-red-500/30 text-red-300" />

                <!-- VUE 1 : INFORMATIONS DU PROFIL -->
                <div id="profileInfoView">
                    <h2 class="text-2xl font-black mb-6 tracking-tight text-white text-center">Mon Profil</h2>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-[10px] uppercase opacity-50 mb-1 font-bold">Nom
                                d'utilisateur</label>
                            <div class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 text-white/50">
                                #{profileBean.utilisateurConnecte.username}
                            </div>
                        </div>

                        <div>
                            <label class="block text-[10px] uppercase opacity-50 mb-1 font-bold">Email</label>
                            <div class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 text-white/50">
                                #{profileBean.utilisateurConnecte.email}
                            </div>
                        </div>

                        <div>
                            <label class="block text-[10px] uppercase opacity-50 mb-1 font-bold">Description</label>
                            <div
                                class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 text-white/80 italic">
                                #{profileBean.utilisateurConnecte.description}
                            </div>
                        </div>
                    </div>

                    <div class="mt-8 flex flex-col gap-3">
                        <button type="button" onclick="switchToPasswordView()"
                            class="w-full py-3 rounded-xl font-bold bg-white/5 hover:bg-white/10 border border-white/10 transition text-xs uppercase tracking-widest text-red-400">
                            Modifier le mot de passe
                        </button>
                        <button type="button" onclick="closeProfileModal()"
                            class="w-full py-3 rounded-xl font-bold bg-white/5 hover:bg-white/10 transition text-xs uppercase tracking-widest text-white/60">
                            Fermer
                        </button>
                    </div>
                </div>

                <!-- VUE 2 : MODIFICATION MOT DE PASSE -->
                <div id="passwordEditView" style="display: none;">
                    <h2 class="text-2xl font-black mb-6 tracking-tight text-white text-center">Nouveau Mot de Passe</h2>

                    <div class="space-y-4 p-4 rounded-xl bg-white/5 border border-white/10">
                        <div>
                            <label class="block text-[10px] uppercase opacity-50 mb-1 font-bold">Ancien mot de
                                passe</label>
                            <h:inputSecret value="#{profileBean.ancienMotDePasse}"
                                styleClass="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/10 outline-none focus:ring-2 focus:ring-red-600 transition" />
                        </div>

                        <div>
                            <label class="block text-[10px] uppercase opacity-50 mb-1 font-bold">Nouveau mot de
                                passe</label>
                            <h:inputSecret value="#{profileBean.nouveauMotDePasse}"
                                styleClass="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/10 outline-none focus:ring-2 focus:ring-red-600 transition" />
                        </div>

                        <div>
                            <label class="block text-[10px] uppercase opacity-50 mb-1 font-bold">Confirmer le mot de
                                passe</label>
                            <h:inputSecret value="#{profileBean.confirmMotDePasse}"
                                styleClass="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/10 outline-none focus:ring-2 focus:ring-red-600 transition" />
                        </div>
                    </div>

                    <div class="flex gap-4 pt-6">
                        <button type="button" onclick="switchToInfoView()"
                            class="flex-1 py-3 rounded-xl font-bold bg-white/5 hover:bg-white/10 transition uppercase text-xs tracking-widest text-white/60">
                            Annuler
                        </button>
                        <h:commandButton value="Enregistrer" action="#{profileBean.modifierMotDePasse}"
                            styleClass="flex-1 py-3 rounded-xl font-bold bg-red-600 hover:bg-red-700 transition shadow-lg uppercase text-xs tracking-widest cursor-pointer">
                            <f:ajax execute="@form" render="@form"
                                onevent="function(data) { if (data.status === 'success') { /* On reste ou on ferme selon besoin */ } }" />
                        </h:commandButton>
                    </div>
                </div>
            </h:form>
        </div>
    </div>

    <!-- Animation CSS -->
    <style>
        .fade-in-scale {
            animation: fadeInScale 0.3s ease-out forwards;
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.95);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }
    </style>

    <!-- JavaScript -->
    <script>
        function openLogoutModal() { document.getElementById('logoutModalWrapper').style.display = 'flex'; }
        function closeLogoutModal() { document.getElementById('logoutModalWrapper').style.display = 'none'; }
        function closeLogoutModalOnOutside(e) { if (e.target.id === 'logoutModalWrapper') closeLogoutModal(); }

        function openProfileModal() {
            document.getElementById('profileModalWrapper').style.display = 'flex';
            switchToInfoView();
        }
        function closeProfileModal() { document.getElementById('profileModalWrapper').style.display = 'none'; }
        function closeProfileModalOnOutside(e) { if (e.target.id === 'profileModalWrapper') closeProfileModal(); }

        function switchToPasswordView() {
            document.getElementById('profileInfoView').style.display = 'none';
            document.getElementById('passwordEditView').style.display = 'block';
        }
        function switchToInfoView() {
            document.getElementById('profileInfoView').style.display = 'block';
            document.getElementById('passwordEditView').style.display = 'none';
        }
    </script>

</ui:composition>